<nav class="navbar" role="navigation">
  <div class="navbar-inner">

    <!-- Brand -->
    <div class="brand flex items-center gap-2">
      <img src="/assets/images/logo/logo1.png"
           alt="Ipakodo Grammar School 1998 Set Alumni Logo"
           class="h-8 w-auto">
      <span>Ipakodo 1998 Set Alumni</span>
    </div>

    <!-- Desktop Navigation -->
    <div class="nav-links desktop">

      <li><a href="/index.html">Home</a></li>

     <!-- Our Story -->
      <li class="dropdown" aria-haspopup="true">
        <a href="/pages/about.html">Our Story</a>
        <div class="mega-menu">
          <div class="mega-grid">
            <div>
              <h4>About the Association</h4>
              <ul>
                <li><a href="/pages/about.html#history">Our History</a></li>
                <li><a href="/pages/mission.html">Mission & Vision</a></li>
                <li><a href="/pages/constitution.html">Constitution</a></li>
              </ul>
            </div>
            <div>
              <h4>Leadership & Governance</h4>
              <ul>
                <li><a href="/pages/current-leadership.html">Current Leadership</a></li>
                <li><a href="/pages/leader-history.html">Leadership History</a></li>
                <li><a href="/pages/bot.html">Board of Trustees</a></li>
              </ul>
            </div>
            <div>
              <h4>Committees & Structure</h4>
              <ul>
                <li><a href="/pages/electoral.html">Electoral Committee</a></li>
                <li><a href="/pages/outreach.html">Outreach Committee</a></li>
                <li><a href="/pages/endowment.html">Endowment & Funds</a></li>
              </ul>
            </div>
          </div>
        </div>
      </li>

      <!-- Resources -->
      <li class="dropdown" aria-haspopup="true">
        <a href="/pages/resources.html">Resources</a>
        <div class="mega-menu">
          <div class="mega-grid">
            <div>
              <h4>News & Blog</h4>
              <ul>
                
                <li><a href="#">Announcements</a></li>
                <li><a href="#">Latest News</a></li>
                <li><a href="#">Alumni Blog</a></li>                
                <li><a href="#">Newsletters Archive</a></li>
              </ul>
            </div>
            <div>
              <h4>Media Gallery</h4>
              <ul>
                <li><a href="/pages/alumni-songs.html">Alumni Songs & Music</a></li>
                <li><a href="/pages/gallery.html">Photo Albums</a></li>
                <li><a href="/pages/videos.html">Reunion & Event Videos</a></li>
                <li><a href="/pages/gallery.html">Event Highlights Gallery</a></li>
              </ul>
            </div>
            <div>
              <h4>Documents & Downloads</h4>
              <ul>
                <li><a href="/pages/constitution.html">Association Constitution</a></li>
                <li><a href="/pages/meeting-minutes.html">Meeting Minutes</a></li>
                <li><a href="/pages/financial-reports.html">Financial Reports</a></li>
                <li><a href="/pages/forms.html">Forms & Templates</a></li>
              </ul>
            </div>
            <div>
              <h4>Support & Initiatives</h4>
              <ul>
                <li><a href="/pages/job.html">Alumni Job Hub</a></li>
                <li><a href="/pages/business.html">Alumni Business Directory</a></li>
                <li><a href="/pages/welfare.html">Welfare Support</a></li>
                <li><a href="/pages/lift.html">Lift Others Initiative</a></li>
              </ul>
            </div>
          </div>
        </div>
      </li>

      <!-- Alumni Events -->
      <li class="dropdown" aria-haspopup="true">
        <a href="/pages/events.html">Alumni Events</a>
        <div class="mega-menu">
          <div class="mega-grid">
            <div>
              <h4>Upcoming Events</h4>
              <ul>
                <li><a href="/pages/2026-reunion.html">2026 Grand Reunion</a></li>
                <li><a href="/pages/birthday.html">Alumni Birthdays</a></li>
              </ul>
            </div>
            <div>
              <h4>Past Events</h4>
              <ul>
                <li><a href="/pages/2025-reunion.html">2025 Reunion Highlights</a></li>
                <li><a href="/pages/2024-reunion.html">2024 Reunion Highlights</a></li>
              </ul>
            </div>
            <div>
              <h4>Get Involved</h4>
              <ul>
                <li><a href="/pages/join.html">RSVP & Participate</a></li>
                <li><a href="/pages/donate.html">Sponsor an Event</a></li>
              </ul>
            </div>
          </div>
        </div>
      </li>

      <!-- Reports -->
      <li class="dropdown" aria-haspopup="true">
        <a href="/pages/reports.html">Reports</a>
        <div class="mega-menu">
          <div class="mega-grid">
            <div>
              <h4>Financial Reports</h4>
              <ul>
                <li><a href="/pages/reports.html#financial">As at 30 Nov 2025</a></li>
                <li><a href="/pages/audit.html">Audit Summary</a></li>
              </ul>
            </div>
            <div>
              <h4>Alumni Reports</h4>
              <ul>
                <li><a href="/pages/reports.html#reunions">Reunion Reports</a></li>
                <li><a href="/pages/reports.html#membership">Membership & Participation</a></li>
              </ul>
            </div>
            <div>
              <h4>Project Reports</h4>
              <ul>
                <li><a href="/pages/reports.html#projects">Project Status & Outcomes</a></li>
              </ul>
            </div>
          </div>
        </div>
      </li>

      <!-- Support -->
      <li class="dropdown" aria-haspopup="true">
        <a href="/pages/support.html">Support</a>
        <div class="mega-menu">
          <div class="mega-grid">
            <div>
              <h4>Career </h4>
              <ul>
                <li><a href="/pages/job.html">Job Hub</a></li>
              </ul>
            </div>
            <div>
              <h4>Business </h4>
              <ul>
                <li><a href="/pages/business.html">Business Hub</a></li>
              </ul>
            </div>
            <div>
              <h4>Welfare & Care</h4>
              <ul>
                <li><a href="/pages/welfare.html">Welfare Support</a></li>
                <li><a href="/pages/lift.html">Lift Others Initiative</a></li>
              </ul>
            </div>
          </div>
        </div>
      </li>

      <!-- Get Involved -->
      <li class="dropdown" aria-haspopup="true">
        <a href="/pages/get-involved.html">Get Involved</a>
        <div class="mega-menu">
          <div class="mega-grid">
            <div>
              <h4>Ways to Contribute</h4>
              <ul>
                <li><a href="/pages/donate.html">Donate to a Project</a></li>
                <li><a href="/pages/contact.html">Volunteer & Support</a></li>
              </ul>
            </div>
          </div>
        </div>
      </li>

      
      <!-- Login / User Badge (Desktop) -->
      <li id="auth-login-desktop">
        <a href="/auth/login.html">Login</a>
      </li>
      <li id="user-badge-desktop" class="user-menu" style="display:none;">
        <button id="user-menu-trigger" aria-haspopup="true" aria-expanded="false">
          <img id="user-avatar" src="/assets/images/logo/icon-128x128.png" alt="User avatar">
          <span>Hello <strong id="user-name-desktop"></strong></span>
          <span id="role-badge" class="role-badge role-member">Member</span>
          <span class="caret">▾</span>
        </button>
        <div class="user-dropdown">
          <a href="/pages/profile.html">Profile</a>
          <a href="/pages/dashboard.html">Dashboard</a>
          <button type="button" onclick="logout()">Logout</button>
        </div>
      </li>
  <li id="auth-join-desktop"><a href="/auth/register.html">Join</a></li>   
      <li id="auth-join-desktop"><a href="/pages/member-help.html">Help</a></li>
      </div>
    </ul>      
  </li>


    

    <!-- Mobile Toggle -->
    <label for="menu-toggle" class="nav-toggle" aria-label="Open menu">☰</label>
  </div>
</nav>

<!-- Mobile Menu Trigger -->
<input type="checkbox" id="menu-toggle" hidden>

<!-- Mobile Sidebar -->
<aside class="sidebar" aria-label="Mobile navigation">
  <label for="menu-toggle" class="close" aria-label="Close menu">✕</label>

  <ul class="menu">
    <li><a href="/index.html">Home</a></li>

    <!-- Logged-in User Badge (Mobile) -->
    <li id="user-badge-mobile" class="has-submenu" style="display:none;">
      <input type="checkbox" id="user-mobile-toggle" hidden>
      <label for="user-mobile-toggle" class="submenu-toggle">
        <img id="user-avatar-mobile" src="/assets/images/logo/icon-128x128.png" alt="User avatar">
        <div>
          <span>Hello <strong id="user-name-mobile"></strong></span>
          <span id="role-badge-mobile" class="role-badge role-member">Member</span>
        </div>
        <span class="chev">▾</span>
      </label>
      <ul class="submenu">
        <li><a href="/pages/profile.html">My Profile</a></li>
        <li><a href="/pages/dashboard.html">Dashboard</a></li>
        <li><button type="button" onclick="logout()">Logout</button></li>
      </ul>
    </li>

    <!-- Our Story -->
    <li class="has-submenu">
      <input type="checkbox" id="our-story-toggle" hidden>
      <label for="our-story-toggle" class="submenu-toggle">Our Story <span class="chev">▾</span></label>
      <ul class="submenu">
        <li class="submenu-title">About the Association</li>
        <li><a href="/pages/about.html#history">Our History</a></li>
        <li><a href="/pages/mission.html">Mission & Vision</a></li>
        <li><a href="/pages/constitution.html">Constitution</a></li>
        <li class="submenu-title">Leadership & Governance</li>
        <li><a href="/pages/current-leadership.html">Current Leadership</a></li>
        <li><a href="/pages/leader-history.html">Leadership History</a></li>
        <li><a href="/pages/bot.html">Board of Trustees</a></li>
        <li class="submenu-title">Committees & Structure</li>
        <li><a href="/pages/electoral.html">Electoral Committee</a></li>
        <li><a href="/pages/outreach.html">Outreach Committee</a></li>
        <li><a href="/pages/endowment.html">Endowment & Funds</a></li>
      </ul>
    </li>

    <!-- Resources -->
    <li class="has-submenu">
      <input type="checkbox" id="resources-toggle" hidden>
      <label for="resources-toggle" class="submenu-toggle">Resources <span class="chev">▾</span></label>
      <ul class="submenu">
        <li class="submenu-title">News & Blog</li>
         <li><a href="#">Announcements</a></li>
        <li><a href="#">Latest News</a></li>
        <li><a href="#">Alumni Blog</a></li>       
        <li><a href="#">Newsletters Archive</a></li>
        <li class="submenu-title">Media Gallery</li>
        <li><a href="/pages/alumni-songs.html">Alumni Songs & Music</a></li>
        <li><a href="/pages/gallery.html">Photo Albums</a></li>
        <li><a href="/pages/videos.html">Reunion & Event Videos</a></li>
        <li><a href="/pages/gallery.html">Event Highlights Gallery</a></li>
        <li class="submenu-title">Documents & Downloads</li>
        <li><a href="/pages/constitution.html">Association Constitution</a></li>
        <li><a href="/pages/meeting-minutes.html">Meeting Minutes</a></li>
        <li><a href="/pages/financial-reports.html">Financial Reports</a></li>
        <li><a href="/pages/forms.html">Forms & Templates</a></li>
        <li class="submenu-title">Support & Initiatives</li>
        <li><a href="/pages/job.html">Alumni Job Hub</a></li>
        <li><a href="/pages/business.html">Alumni Business Directory</a></li>
        <li><a href="/pages/welfare.html">Welfare Support</a></li>
        <li><a href="/pages/lift.html">Lift Others Initiative</a></li>
      </ul>
    </li>

    <!-- Alumni Events -->
    <li class="has-submenu">
      <input type="checkbox" id="events-toggle" hidden>
      <label for="events-toggle" class="submenu-toggle">Alumni Events <span class="chev">▾</span></label>
      <ul class="submenu">
        <li class="submenu-title">Upcoming Events</li>
        <li><a href="/pages/2026-reunion.html">2026 Grand Reunion</a></li>
        <li><a href="/pages/birthday.html">Alumni Birthdays</a></li>
        <li class="submenu-title">Past Events</li>
        <li><a href="/pages/2025-reunion.html">2025 Reunion Highlights</a></li>
        <li><a href="/pages/2024-reunion.html">2024 Reunion Highlights</a></li>
        <li class="submenu-title">Get Involved</li>
        <li><a href="/pages/join.html">RSVP & Participate</a></li>
        <li><a href="/pages/donate.html">Sponsor an Event</a></li>
      </ul>
    </li>

    <!-- Reports -->
    <li class="has-submenu">
      <input type="checkbox" id="reports-toggle" hidden>
      <label for="reports-toggle" class="submenu-toggle">Reports <span class="chev">▾</span></label>
      <ul class="submenu">
        <li class="submenu-title">Financial Reports</li>
        <li><a href="/pages/reports.html#financial">Financial Statement (As at 30 Nov 2025)</a></li>
        <li><a href="/pages/audit.html">Audit Summary</a></li>
        <li class="submenu-title">Alumni Reports</li>
        <li><a href="/pages/reports.html#reunions">Reunion Reports</a></li>
        <li><a href="/pages/reports.html#membership">Membership & Participation</a></li>
        <li class="submenu-title">Project Reports</li>
        <li><a href="/pages/reports.html#projects">Project Status & Outcomes</a></li>
      </ul>
    </li>

    <!-- Support -->
    <li class="has-submenu">
      <input type="checkbox" id="support-toggle" hidden>
      <label for="support-toggle" class="submenu-toggle">Support <span class="chev">▾</span></label>
      <ul class="submenu">
        <li class="submenu-title">Career Support</li>
        <li><a href="/pages/job.html">Alumni Job Hub</a></li>
        <li class="submenu-title">Business & Enterprise</li>
        <li><a href="/pages/business.html">Alumni Business Hub</a></li>
        <li class="submenu-title">Welfare & Care</li>
        <li><a href="/pages/welfare.html">Welfare Support</a></li>
        <li><a href="/pages/lift.html">Lift Others Initiative</a></li>
      </ul>
    </li>

    <!-- Get Involved -->
    <li class="has-submenu">
      <input type="checkbox" id="get-involved-toggle" hidden>
      <label for="get-involved-toggle" class="submenu-toggle">Get Involved <span class="chev">▾</span></label>
      <ul class="submenu">
        <li class="submenu-title">Ways to Contribute</li>
        <li><a href="/pages/donate.html">Donate to a Project</a></li>
        <li><a href="/pages/contact.html">Volunteer & Support</a></li>
      </ul>
    </li>

    <!-- Auth Links (Mobile - logged out) -->
    <li class="menu-divider" id="mobile-auth-divider"></li>
       <li id="auth-login-mobile"><a href="/auth/login.html">Login</a></li>
    <li id="auth-join-mobile"><a href="/auth/register.html">Join</a></li> 
     <li id="auth-join-desktop"><a href="/pages/member-help.html">Help</a></li>
  </ul>
</aside>

<!-- Mobile Overlay -->
<label for="menu-toggle" class="overlay" aria-hidden="true"></label>

<style>
  /* =====================================================
   NAVBAR — Clean Premium Header
   ===================================================== */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: linear-gradient(180deg, #1e3a8a 0%, #172e6e 100%);
  color: #fff;
  z-index: 3000;
  box-shadow: 0 6px 18px rgba(0,0,0,.16);
}

.navbar-inner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
}

.brand {
  display: flex;
  align-items: center;
  gap: .6rem;
  font-weight: 700;
  letter-spacing: .02em;
}

.brand-logo {
  height: 28px;
  width: auto;
}

/* Toggle */
.nav-toggle {
  font-size: 26px;
  cursor: pointer;
  user-select: none;
  line-height: 1;
  transition: transform .2s ease, opacity .2s ease;
}
.nav-toggle:hover {
  opacity: .85;
  transform: scale(1.05);
}

/* =====================================================
   SIDEBAR — Premium Solid Panel
   ===================================================== */
.sidebar {
  position: fixed;
  top: 0;
  left: -300px;
  width: 300px;
  height: 100vh;
  background: linear-gradient(
    135deg,
    #000e35d0 0%,
    #01194996 65%,
    #01011f83 100%
  );
  color: #fff;
  box-shadow: 14px 0 36px rgba(0,0,0,.38);
  transition: left .45s cubic-bezier(.4,0,.2,1);
  z-index: 4000;
  padding: 1.5rem 1.25rem;
  overflow-y: auto;
}

#menu-toggle:checked ~ .sidebar {
  left: 0;
}

/* Close */
.close {
  font-size: 20px;
  cursor: pointer;
  display: inline-block;
  margin-bottom: 1.25rem;
  opacity: .85;
  transition: opacity .2s ease, transform .2s ease;
}
.close:hover {
  opacity: 1;
  transform: translateX(-2px);
}

/* =====================================================
   MENU — Refined Navigation
   ===================================================== */
.menu {
  list-style: none;
  padding: 0;
  margin: 0;
}

.menu > li {
  margin-bottom: .35rem;
}

.menu a {
  display: block;
  padding: .75rem 0;
  color: #fff;
  text-decoration: none;
  font-weight: 500;
  letter-spacing: .01em;
  transition: color .25s ease, padding-left .25s ease;
}

.menu a:hover {
  color: #fae105;
  padding-left: .25rem;
}

/* Premium divider */
.menu-divider {
  height: 1px;
  background: linear-gradient(
    to right,
    rgba(255,255,255,.08),
    rgba(255,255,255,.18),
    rgba(255,255,255,.08)
  );
  margin: .85rem 0;
}

/* =====================================================
   SUBMENUS — Elegant CSS Accordion
   ===================================================== */
.has-submenu {
  margin-bottom: .5rem;
}

.submenu-toggle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: .75rem 0;
  cursor: pointer;
  font-weight: 600;
  color: #fff;
  letter-spacing: .02em;
}

.chev {
  transition: transform .35s cubic-bezier(.4,0,.2,1);
}

.submenu {
  max-height: 0;
  overflow: hidden;
  transition: max-height .45s cubic-bezier(.4,0,.2,1);
  padding-left: 1rem;
}

.has-submenu input:checked + .submenu-toggle .chev {
  transform: rotate(180deg);
}

.has-submenu input:checked ~ .submenu {
  max-height: 900px;
}

.submenu-title {
  font-size: .75rem;
  text-transform: uppercase;
  letter-spacing: .12em;
  margin: .85rem 0 .35rem;
  color: #fae105;
  font-weight: 600;
}

/* =====================================================
   OVERLAY — Soft Modal Backdrop
   ===================================================== */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  opacity: 0;
  pointer-events: none;
  transition: opacity .45s cubic-bezier(.4,0,.2,1);
  z-index: 3500;
}

#menu-toggle:checked ~ .overlay {
  opacity: 1;
  pointer-events: auto;
}

/* =====================================================
   DESKTOP — Sidebar Disabled
   ===================================================== */
@media (min-width: 900px) {
  .nav-toggle,
  .sidebar,
  .overlay {
    display: none;
  }
}
/* =====================================================
   ACTIVE LINK STYLES
   ===================================================== */ 
.nav-links a.active,
.menu a.active {
  color: #fae105;
  font-weight: 700;
} 
/* =====================================================
   USER BADGE STYLES
   ===================================================== */
.user-menu {
  position: relative;
}
.user-menu button {
  display: flex;
  align-items: center;
  gap: .5rem;
  background: none;
  border: none;
  color: #fff;
  cursor: pointer;
  font-weight: 500;
  letter-spacing: .01em;
  padding: .5rem .75rem;
  border-radius: 4px;
  transition: background .25s ease;
} 
.user-menu button:hover {
  background: rgba(255,255,255,.1);
}
.user-menu img {
  height: 32px;
  width: 32px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #fff;
}   
.user-menu .caret {
  font-size: 12px;
}
.user-menu.open button .caret {
  transform: rotate(180deg);
}
.user-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  background: #fff;
  color: #333;
  min-width: 160px;
  box-shadow: 0 4px 12px rgba(0,0,0,.15);
  border-radius: 4px;
  overflow: hidden;
  opacity: 0;
  visibility: hidden;
  transform: translateY(10px);
  transition: opacity .25s ease, transform .25s ease, visibility .25s ease;
  z-index: 5000;
}
.user-menu.open .user-dropdown {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}
.user-dropdown a,
.user-dropdown button {
  display: block;
  width: 100%;
  padding: .75rem 1rem;
  background: none;
  border: none;
  text-align: left;
  color: #333;
  text-decoration: none;
  font-weight: 500;
  cursor: pointer;
  transition: background .2s ease;
} 
.user-dropdown a:hover,
.user-dropdown button:hover {
  background: #f0f0f0;
}   
/* =====================================================
   ROLE BADGE STYLES
   ===================================================== */ 
.role-badge {
  display: inline-block;    
  padding: .15rem .5rem;
  font-size: .7rem; 

  font-weight: 600;
  border-radius: 12px;    
  text-transform: uppercase;
  letter-spacing: .08em;  
  background: #666;
  color: #fff;
  margin-left: .5rem;
}
.role-member {
  background: #4caf50;
} 
.role-admin {
  background: #f44336;
}
.role-moderator {
  background: #ff9800;
}
.role-vip {
  background: #9c27b0;
  color: #fff;
  margin-left: .5rem;
}


</style>
</style>
<script type="module">
import { supabase } from '/assets/js/supabase-client.js';

/* =========================================================
   ACTIVE LINK HIGHLIGHT (desktop + mobile)
   ========================================================= */

document.addEventListener('DOMContentLoaded', () => {
  const currentPath = window.location.pathname.replace(/\/$/, '') || '/';

  // Desktop links
  document.querySelectorAll('.nav-links.desktop a').forEach(link => {
    const linkPath = link.getAttribute('href')?.replace(/\/$/, '');
    if (linkPath === currentPath) link.classList.add('active');
  });

  // Mobile links
  document.querySelectorAll('.sidebar .menu a').forEach(link => {
    const linkPath = link.getAttribute('href')?.replace(/\/$/, '');
    if (linkPath === currentPath) link.classList.add('active');
  });
});

/* =========================================================
   SUPABASE AUTH UI
   ========================================================= */

function updateNavbarAuth(user) {
  const loginDesktop = document.getElementById('auth-login-desktop');
  const joinDesktop = document.getElementById('auth-join-desktop');
  const userBadgeDesktop = document.getElementById('user-badge-desktop');
  const userNameDesktop = document.getElementById('user-name-desktop');
  const avatarDesktop = document.getElementById('user-avatar');
  const roleBadgeDesktop = document.getElementById('role-badge');

  const loginMobile = document.getElementById('auth-login-mobile');
  const joinMobile = document.getElementById('auth-join-mobile');
  const userBadgeMobile = document.getElementById('user-badge-mobile');
  const userNameMobile = document.getElementById('user-name-mobile');
  const avatarMobile = document.getElementById('user-avatar-mobile');
  const roleBadgeMobile = document.getElementById('role-badge-mobile');

  const PLACEHOLDER_AVATAR = '/assets/images/logo/icon-128x128.png';

  if (!user) {
    // Logged out
    if (loginDesktop) loginDesktop.style.display = 'block';
    if (joinDesktop) joinDesktop.style.display = 'block';
    if (userBadgeDesktop) userBadgeDesktop.style.display = 'none';

    if (loginMobile) loginMobile.style.display = 'block';
    if (joinMobile) joinMobile.style.display = 'block';
    if (userBadgeMobile) userBadgeMobile.style.display = 'none';

    if (avatarDesktop) avatarDesktop.src = PLACEHOLDER_AVATAR;
    if (avatarMobile) avatarMobile.src = PLACEHOLDER_AVATAR;
    return;
  }

  // Logged in
  const firstName = user.user_metadata?.full_name?.split(' ')[0] || 'Member';

  if (userNameDesktop) userNameDesktop.textContent = firstName;
  if (userNameMobile) userNameMobile.textContent = firstName;

  let avatarUrl = PLACEHOLDER_AVATAR;
  if (user.user_metadata?.avatar_url?.trim()) {
    avatarUrl = user.user_metadata.avatar_url;
  }
  if (avatarDesktop) avatarDesktop.src = avatarUrl;
  if (avatarMobile) avatarMobile.src = avatarUrl;

  const role = (user.user_metadata?.role || user.app_metadata?.role || 'member').toLowerCase();

  if (roleBadgeDesktop) {
    roleBadgeDesktop.textContent = role.toUpperCase();
    roleBadgeDesktop.className = `role-badge role-${role}`;
  }
  if (roleBadgeMobile) {
    roleBadgeMobile.textContent = role.toUpperCase();
    roleBadgeMobile.className = `role-badge role-${role}`;
  }

  if (loginDesktop) loginDesktop.style.display = 'none';
  if (joinDesktop) joinDesktop.style.display = 'none';
  if (userBadgeDesktop) userBadgeDesktop.style.display = 'block';

  if (loginMobile) loginMobile.style.display = 'none';
  if (joinMobile) joinMobile.style.display = 'none';
  if (userBadgeMobile) userBadgeMobile.style.display = 'block';
}

async function initNavbarAuth() {
  const { data: { user } } = await supabase.auth.getUser();
  updateNavbarAuth(user);
}

// Real-time auth listener
supabase.auth.onAuthStateChange((event, session) => {
  console.log('Auth state changed:', event);
  updateNavbarAuth(session?.user || null);
});

document.addEventListener('DOMContentLoaded', initNavbarAuth);

/* =========================================================
   USER DROPDOWN (DESKTOP)
   ========================================================= */

(() => {
  const menu = document.getElementById('user-badge-desktop');
  const trigger = document.getElementById('user-menu-trigger');
  if (!menu || !trigger) return;

  trigger.addEventListener('click', e => {
    e.stopPropagation();
    menu.classList.toggle('open');
  });

  document.addEventListener('click', () => menu.classList.remove('open'));
})();

/* =========================================================
   LOGOUT
   ========================================================= */

window.logout = async () => {
  await supabase.auth.signOut();
  window.location.href = '/index.html';
};

/* =========================================================
   HOVER SOUND (extended to mobile links)
   ========================================================= */

(() => {
  const SOUND_SRC = '/assets/sounds/hover.wav';
  const hoverSound = new Audio(SOUND_SRC);
  hoverSound.volume = 0.25;
  hoverSound.preload = 'auto';

  let lastPlayed = 0;
  const COOLDOWN = 120;

  function playHoverSound() {
    const now = Date.now();
    if (now - lastPlayed < COOLDOWN) return;
    lastPlayed = now;
    hoverSound.currentTime = 0;
    hoverSound.play().catch(() => {});
  }

  function bindHoverSounds() {
    document.querySelectorAll('.navbar a, .sidebar a, .nav-toggle, .submenu-toggle').forEach(el => {
      el.addEventListener('mouseenter', playHoverSound);
      el.addEventListener('focus', playHoverSound);
    });
  }

  const wait = setInterval(() => {
    if (document.querySelector('.navbar')) {
      clearInterval(wait);
      bindHoverSounds();
    }
  }, 50);
})();
</script>