<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ipakodo Grammar School 1998 Set Alumni – Gallery</title>

<meta name="description" content="Official photo gallery of the Ipakodo Grammar School 1998 Set Alumni Association.">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { sans: ['Poppins', 'sans-serif'] },
      colors: {
        primary: '#1e3a8a',
        muted: '#64748b',
        soft: '#f8fafc'
      }
    }
  }
}
</script>

<style>
.masonry {
  column-count: 2;
  column-gap: 1.25rem;
}
@media(min-width:768px){ .masonry{column-count:3} }
@media(min-width:1024px){ .masonry{column-count:4} }
.masonry-item{ break-inside:avoid; margin-bottom:1.25rem; }
</style>
</head>

<body class="bg-soft text-slate-800">

<!-- HEADER -->
<header class="bg-primary text-white py-16">
  <div class="max-w-7xl mx-auto px-6 text-center">
    <h1 class="text-4xl md:text-5xl font-bold">1998 Set Alumni Gallery</h1>
    <p class="mt-4 text-white/90 max-w-3xl mx-auto">
      Official visual archive of reunions, meetings, school visits and alumni milestones.
    </p>
  </div>
</header>

<main class="max-w-7xl mx-auto px-6 py-14">

<section class="mb-10 flex items-center justify-between gap-6 flex-wrap">
  <h2 class="text-2xl font-semibold text-primary" id="view-title">All Photographs</h2>
  <button id="backBtn" class="hidden bg-primary text-white px-5 py-2 rounded-full">
    ← Back to Albums
  </button>
</section>

<section id="albums" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 mb-16"></section>

<section id="photos" class="masonry"></section>

<p id="empty" class="hidden text-center text-muted text-xl py-20">No photographs found.</p>

</main>

<!-- LIGHTBOX -->
<div id="lightbox" class="hidden fixed inset-0 bg-black/95 z-50 flex items-center justify-center">
  <button class="absolute top-6 right-6 text-white text-4xl" onclick="closeBox()">×</button>
  <button class="absolute left-6 text-white text-5xl" onclick="prev()">‹</button>
  <img id="lightImg" class="max-w-full max-h-full rounded-lg shadow-2xl">
  <button class="absolute right-6 text-white text-5xl" onclick="next()">›</button>
  <div class="absolute bottom-8 text-white text-lg bg-black/70 px-6 py-3 rounded">
    <span id="caption"></span>
  </div>
</div>

<script>
const API_KEY = 'AIzaSyDU0vZN_AE1glGIMEZO42xAdJzOMkjYPfA';
const ROOT = '1VzuJ_hV2mKpHDOuJOxp--4e_PjheZQUK';

let allPhotos = [];
let current = [];
let index = 0;

const drive = async q => {
  const r = await fetch(`https://www.googleapis.com/drive/v3/files?${q}&key=${API_KEY}`);
  return r.json();
};

const cleanCaption = (album, time) => {
  const year = time ? new Date(time).getFullYear() : '';
  return `${year} ${album} – Alumni Photograph`.trim();
};

async function loadAlbums(){
  const data = await drive(`q='${ROOT}'+in+parents+and+mimeType='application/vnd.google-apps.folder'&fields=files(id,name)`);
  const box = document.getElementById('albums');
  box.innerHTML = '';

  for(const a of data.files){
    const cover = await drive(`q='${a.id}'+in+parents&fields=files(id)&pageSize=1`);
    const img = cover.files[0]?.id;
    const src = img ? `https://drive.google.com/thumbnail?id=${img}&sz=w800` : '';

    const card = document.createElement('div');
    card.className = 'bg-white rounded-xl shadow hover:shadow-xl cursor-pointer';
    card.innerHTML = `
      <img src="${src}" class="aspect-square object-cover rounded-t-xl">
      <div class="p-4 text-center font-medium">${a.name}</div>
    `;
    card.onclick = () => loadAlbum(a.id, a.name);
    box.appendChild(card);
  }
}

async function loadAlbum(id,name){
  document.getElementById('albums').classList.add('hidden');
  document.getElementById('backBtn').classList.remove('hidden');
  document.getElementById('view-title').textContent = name;

  const data = await drive(`q='${id}'+in+parents&fields=files(id,createdTime,mimeType)`);
  current = data.files.filter(f=>f.mimeType.startsWith('image/'));
  render(current,name);
}

function render(list,album){
  const box = document.getElementById('photos');
  box.innerHTML='';
  if(!list.length){ document.getElementById('empty').classList.remove('hidden'); return; }

  list.forEach((p,i)=>{
    const cap = cleanCaption(album,p.createdTime);
    const img = `https://drive.google.com/thumbnail?id=${p.id}&sz=w800`;
    const div = document.createElement('div');
    div.className='masonry-item cursor-pointer';
    div.innerHTML = `
      <img src="${img}" class="rounded-xl shadow hover:shadow-xl">
      <p class="text-sm text-muted mt-2 text-center">${cap}</p>
    `;
    div.onclick=()=>open(list,i,album);
    box.appendChild(div);
  });
}

function open(list,i,album){
  current=list; index=i;
  show(album);
  document.getElementById('lightbox').classList.remove('hidden');
}

function show(album){
  const p=current[index];
  document.getElementById('lightImg').src =
    `https://drive.google.com/thumbnail?id=${p.id}&sz=w2000`;
  document.getElementById('caption').textContent =
    cleanCaption(album,p.createdTime);
}
function closeBox(){document.getElementById('lightbox').classList.add('hidden')}
function prev(){index=(index-1+current.length)%current.length;show(document.getElementById('view-title').textContent)}
function next(){index=(index+1)%current.length;show(document.getElementById('view-title').textContent)}

document.getElementById('backBtn').onclick=()=>{
  document.getElementById('albums').classList.remove('hidden');
  document.getElementById('backBtn').classList.add('hidden');
  document.getElementById('view-title').textContent='All Photographs';
  document.getElementById('photos').innerHTML='';
};

loadAlbums();
</script>

</body>
</html>
